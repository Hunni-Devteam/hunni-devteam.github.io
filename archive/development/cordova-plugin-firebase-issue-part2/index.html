<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">Hunni.Devteam</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Software Engineer, Hun Kang's Personal Blog"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/7ccbfe27e8f61ef9be1e.js" as="script"><link rel="preload" href="/_nuxt/699ac235b5a7295b4c5d.js" as="script"><link rel="preload" href="/_nuxt/de3fcad20eed6159d31a.js" as="script"><link rel="preload" href="/_nuxt/db66437d587c82d09d81.js" as="script"><link rel="preload" href="/_nuxt/0a042519357e71d7ac5c.js" as="script"><link rel="preload" href="/_nuxt/d6690b90986abc8975ba.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 132df51d:0 12d4cb96:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#333;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}*{letter-spacing:-.12px}ol,ul{list-style:none;margin:0;padding:0}article,aside,div,footer,header,main,nav,section{position:relative;box-sizing:border-box}#layout{display:flex;min-height:100vh}#disqus_thread{padding:32px}.splash{position:fixed;left:0;top:0;z-index:10;width:100%;height:100%;background-color:#2c2c2c;display:flex;justify-content:center;align-items:center}.splash.inactive{display:none}.page-content-wrapper{flex:1;background-color:#e9e9e9}.bg-white{background-color:#fff}.article-viewer{margin:24px}.article-viewer .tui-editor-contents{color:#333}.article-viewer .tui-editor-contents h1{font-weight:400;line-height:48px;border-bottom-width:2px;border-bottom-style:solid}.article-viewer .tui-editor-contents p{color:#333}nav.main-navigation{width:320px;background-color:#292929}nav.main-navigation li span{cursor:pointer}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div id="layout"><div class="splash inactive"><div style="width:100%;height:50px"><div style="display:inline-block;color:#fff;font-size:42px">Hunni.Devteam</div></div></div> <nav class="main-navigation" style="display:flex;flex-direction:column;justify-content:center;align-items:center"><div style="color:#f9f9f9;text-align:center;margin-bottom:56px;margin-top:48px"><div style="display:inline-block;margin-bottom:8px;font-size:30px;letter-spacing:.12px;cursor:pointer">Hunni.Devteam</div><br> <span class="catchphrase" style="font-size:17px;color:#d9d9d9">Own the day, own your life</span></div> <ul style="margin-bottom:56px;font-size:18px;color:#e9e9e9;width:100%"><li style="line-height:48px;margin:0 56px"><span>About</span></li> <li style="line-height:48px;margin:0 56px"><span>Development Archive</span> <ul style="line-height:28px;font-size:14px;color:#b9b9b9"><li><span>- Web Frontend</span></li> <li><span>- Web Backend</span></li> <li><span>- API Document</span></li> <li><span>- Algorithm</span></li> <li><span>- Development Tip</span></li> <li><span>- Language Spec</span></li> <li><span>- Issues</span></li> <li><span>- DevOps</span></li></ul></li> <li style="line-height:48px;margin:0 56px">Life Archive</li> <li style="line-height:48px;margin:0 56px">Resume</li></ul> <div style="color:#9c9c9c;font-size:18px">Twitter / Facebook / Google</div> <div style="flex:1"></div></nav> <div class="page-content-wrapper"><div><div style="height:48px;line-height:48px;background-color:#fff;margin:0 0 24px 0;padding:0 24px"><span><span>home</span></span><span><span><span> / </span> <span></span></span></span></div> <div class="bg-white" style="margin:0 24px 24px 24px"><article><div><div id="title" style="height:320px;background-position:center;background-size:cover;background-image:url(/disqus-cover.png)"></div></div> <div class="article-viewer">
          2019년 7월 15일 월요일 오전 8:57 작성
          <tui-viewer value="
# cordova-plugin-firebase 오류 기록 - Part 2

오류를 추적하면서 알아낸 내용을 이어 적습니다.
이번 글부터는 작성 편의를 위해 존칭을 생략합니다.. :>

원인 분석
-
https://firebase.google.com/support/release-notes/android#update_-_june_17_2019
위의 Firebase SDK 업데이트 내용을 보면 Android Support 패키지를  Jetpack(AndroidX) 로 마이그레이션했다는 내용이 있다.
따라서 최신 Firebase SDK를 사용하게 되면 Jetpack 사용이 강제된단 뜻인데,  만약 플러그인에서 Firebase 의존성을 느슨하게 체크했다면 충분히 문제가 될 수 있다.
그래서 해당 플러그인 의존성을 확인해 보니 firebase-auth 패키지가 항상 최신 버전을 향하도록 되어있던 것이다.

위 글을 자세히 보면 Authentication Version 18.0.0 부터 변경점이 반영된다고 했다.
이제 의존성을 살펴보자.

> cordova-plugin-firebase/src/android/build.gradle - line 20
```
dependencies {
    compile 'me.leolin:ShortcutBadger:1.1.4@aar'
    // 항상 최신 버전으로 유지?
    compile 'com.google.firebase:firebase-auth:+'
    compile('com.crashlytics.sdk.android:crashlytics:2.9.1@aar') {
       transitive = true
    }
}
```
gradle 의존성 정의 내용을 보니, firebase-auth 라이브러리를 항상 최신 버전으로 유지하게(com.google.firebase:firebase-auth:+) 해 놨다.
그렇다면 소스 코드도 같이 살펴보자.
> cordova-plugin-firebase/src/android/firebasePlugin.java - line 9
```
 import android.support.v4.app.NotificationManagerCompat;
 ```
AndroidX 사용하도록 소스를 고치거나, firebase-auth 다운그레이드가 필요한 상태였지만 아직 반영되지 않은 상태였다.

직접 소스를 고치거나, 의존성 오류를 방지할 필요가 있어 구글링을 더 해봤다.

조치
-
해당 플러그인의 Github 저장소 - issues 탭에서 많은 내용을 얻었다.
댓글 내용을 참고해 수정하면 된다.

충돌 발생할 수 있는 플러그인 목록, 안정적인 버전 알려준 댓글
[https://github.com/arnesson/cordova-plugin-firebase/issues/1081#issuecomment-503041641](https://github.com/arnesson/cordova-plugin-firebase/issues/1081#issuecomment-503041641)
> Providing `17.1.1` for `firebase-iid` solves the dependency wild card issue.  
Providing `16.2.0` for `firebase-auth` solves double class present in the class path issue.

안정적인 버전으로 Dependency Replace 하는 스크립트
[https://github.com/arnesson/cordova-plugin-firebase/issues/1083#issuecomment-503224816](https://github.com/arnesson/cordova-plugin-firebase/issues/1083#issuecomment-503224816)

위 링크 내용대로 build-extras.gradle 스크립트 추가하고,
nodeJS 로 파일 복사해주는 hook 코드 작성하고
config.xml에서 after_prepare 훅에 해당 스크립트 실행하게 하면 오류 없이 동작한다.


회고
-
하이브리드 앱 개발은 두 번째지만, 네이티브 앱을 개발해본 적이 없으니 플랫폼 의존적인 이슈가 터졌을 때 당황하게 된다.

앞으로도 Cordova 생태계 또는 모바일 환경에서 개발을 계속하게 된다면, 네이티브 개발에 쓸 언어와 프레임워크(Kotlin, Swift, Cocoa 등) 공부도 적극적으로 할 필요가 있을 것 같다.
"></tui-viewer></div></article> <section src="https://hunni-devteam-1.disqus.com/embed.js"><div id="disqus_thread"></div> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></section></div></div></div></div></div></div><script>window.__NUXT__=function(e,a,t,r,i,o,s,c,d,n,l){return{layout:"default",data:[{},{}],error:null,state:{pageShortcuts:[{created_at:"2019-05-20 03:30:00",title:n,description:n,tags:["disqus","blog-development"],src:"/archive/development/disqus-comment-test",image:i},{created_at:"2019-05-23 21:30:00",title:"Laravel 쿼리 빌더 사용으로 인한 MSSQL 성능 이슈",description:"컬럼 타입 강제 캐스팅으로 인해 인덱스를 타지 않았다.",tags:[t,"web-backend","laravel","perfomance",r],src:"/archive/development/laravel-query-builder-causes-mssql-perfomance-issue",image:e},{created_at:d,title:"Cordova-Based SPA에 핫 리로딩 적용하기",description:"config.xml - content 태그 값 변경으로 손쉽게 적용할 수 있어요.",tags:[t,o,a,s,c],src:"/archive/development/usage-of-cordova-remote-page-content",image:e},{created_at:d,title:"Cordova + Vue.js 연동하기",description:"Vue CLI 3 너무 편해요!",tags:[t,o,a,s,c],src:"/archive/development/use-cordova-with-vue-cli-3",image:e},{created_at:"2019-07-07 15:40:00",title:"Vuex, 커링, 클로저.",description:"알게 모르게 써오던 개념 정리",tags:[o,s,c,"ES6","functional-programming"],src:"/archive/development/vuex-currying-closure",image:e},{created_at:"2019-07-15 08:54:00",title:"cordova-plugin-firebase 오류 기록 - Part 1",description:"플랫폼 의존적인 플러그인 오류 분석(실패)..",tags:[a,l,r],src:"/archive/development/cordova-plugin-firebase-issue-part1",image:i},{created_at:"2019-07-15 08:57:00",title:"cordova-plugin-firebase 오류 기록 - Part 2",description:"오류 내용 분석과 조치 방법 정리",tags:[a,l,r],src:"/archive/development/cordova-plugin-firebase-issue-part2",image:i}]},serverRendered:!0}}("/laravel-logo.png","cordova","draft","issue","/disqus-cover.png","web-frontend","vue","development-tip","2019-05-24 18:00:00","Disqus 연동 테스트","android")</script><script src="/_nuxt/7ccbfe27e8f61ef9be1e.js" defer></script><script src="/_nuxt/0a042519357e71d7ac5c.js" defer></script><script src="/_nuxt/d6690b90986abc8975ba.js" defer></script><script src="/_nuxt/699ac235b5a7295b4c5d.js" defer></script><script src="/_nuxt/de3fcad20eed6159d31a.js" defer></script><script src="/_nuxt/db66437d587c82d09d81.js" defer></script>
  </body>
</html>
